static readonly updateTask = '
UPDATE dbo.Task 
SET 
    TaskStatus = ISNULL(@taskStatus, TaskStatus),
    AssignedUserRoleID = CASE 
        WHEN @assignedUserId IS NOT NULL AND @taskStatus = ''PendingRerun'' THEN 
            (SELECT UserRoleId 
             FROM UserRoleAssignment 
             WHERE UserId = @assignedUserId 
             AND (UserRoleEndDt > GETDATE() OR UserRoleEndDt IS NULL))
        ELSE AssignedUserRoleID
    END,
    AssignedUserID = CASE
        WHEN @assignedUserId IS NOT NULL THEN ISNULL(@assignedUserId, AssignedUserID)
        ELSE AssignedUserID
    END,
    UpdateDate = CURRENT_TIMESTAMP
WHERE TaskID = @taskId;
';

UPDATE dbo.Task
SET TaskStatus = ISNULL(@taskStatus, TaskStatus),
  AssignedUserID = COALESCE(@assignedUserID, AssignedUserID),
  AssignedUserRoleID = 
    CASE 
      WHEN @assignedUserID IS NOT NULL THEN
        (SELECT UserRoleId FROM UserRoleAssignment 
         WHERE UserId = @assignedUserID
           AND (UserRoleEndDt > GETDATE() OR UserRoleEndDt IS NULL)
           AND @taskStatus = 'PendingRerun')
      ELSE NULL
    END,
  UpdateDate = CURRENT_TIMESTAMP
WHERE TaskID = @taskId;



UPDATE dbo.Task
SET TaskStatus = ISNULL(@taskStatus, TaskStatus),
  AssignedUserID = COALESCE(@assignedUserID, AssignedUserID),
  AssignedUserRoleID = 
    CASE 
      WHEN @assignedUserID IS NOT NULL THEN
        (SELECT UserRoleId FROM UserRoleAssignment 
         WHERE UserId = @assignedUserID
           AND (UserRoleEndDt > GETDATE() OR UserRoleEndDt IS NULL)
           AND @taskStatus = 'PendingRerun')
      ELSE NULL
    END,
  UpdateDate = CURRENT_TIMESTAMP
WHERE TaskID = @taskId;


